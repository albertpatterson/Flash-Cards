<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Flash Cards</title>
  <link rel="shortcut icon" href="favicon.ico"/>
  <meta name="description" content="Flash cards for studying Chinese">
  <meta name="author" content="Albert Patterson">

  <!-- <script src="https://apis.google.com/js/platform.js" async defer></script> -->
  <link rel="stylesheet" href="css/styles.css"/>

</head>
<body>

  <script>
    function handleClientLoad() { 
      // Loads the client library and the auth2 library together for efficiency.
      // Loading the auth2 library is optional here since `gapi.client.init` function will load
      // it if not already loaded. Loading it upfront can save one network request.
      gapi.load('client:auth2', initClient);
    }

    function handleSignInClick(event) {
      // Ideally the button should only show up after gapi.client.init finishes, so that this
      // handler won't be called before OAuth is initialized.
      gapi.auth2.getAuthInstance().signIn();
    }

    function initClient() {
      // Initialize the client with API key and People API, and initialize OAuth with an
      // OAuth 2.0 client ID and scopes (space delimited string) to request access.
      gapi.client.init({
          apiKey: 'AIzaSyBXBROkk9uvCEuhxrRgcLir2Ia0w_Cpvjs',
          discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4",
                          "https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
          clientId: '654884288051-tljp13krpkhd0vmv71arp2lrt2avc0br.apps.googleusercontent.com',
          scope: 'https://www.googleapis.com/auth/drive'
      }).then(function () {
        // Listen for sign-in state changes.
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

        // Handle the initial sign-in state.
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
      });

      function updateSigninStatus(isSignedIn) {
        // When signin status changes, this function is called.
        // If the signin status is changed to signedIn, we make an API call.
        document.getElementById("loading-modal").classList.remove("showing");        
        if (isSignedIn) {
          // console.log('signed in: ', isSignedIn);
          document.getElementById("app-modal").classList.add("showing");
        }else{
          document.getElementById("login-modal").classList.add("showing");
        }
      }
    }
  </script>

  <script async defer src="https://apis.google.com/js/api.js"
    onload="this.onload=function(){};handleClientLoad()"
    onreadystatechange="if (this.readyState === 'complete') this.onload()"></script>

  <div id="loading-modal" class="modal default-hidden showing">
    <h2 class="section main-text">Loading...</h2>
  </div>

  <div id="login-modal" class="modal default-hidden">
    <h2 class="section main-text">Welcome Message and app description</h2>
    <div id="google-sign-in-btn" onclick="handleSignInClick()"></div>
  </div>

  <div id="app-modal" class="modal default-hidden">
    <button id="settings-btn" data-nav="settings-panel"></button>

    <!-- Google Flow -->
    <div id="choose-list" class="modal-content default-hidden showing">
      <h2 class="section main-text">Choose word list</h2>
      <div data-error="use-alberts-list" class="section error-message default-hidden"></div>
      <div class="section">
        <button class="btn" data-action="use-alberts-list" data-nav="choose-sheets">Albert's List</button>
        <button class="btn" data-nav="choose-spreadsheet">My List</button>
      </div>
    </div>

    <div id="choose-spreadsheet" class="modal-content default-hidden">
      <h2 class="section main-text">What is the ID<a id="spreadsheet-info"></a> of your spreadsheet?</h2>
      <div class="section">
        <input type="text"  class="input" placeholder="spreadsheet ID" id="spreadsheet-id">
      </div>
      <div data-error="set-spreadsheet-id" class="section error-message default-hidden"></div>
      <div class="section">
        <button class="btn" data-nav="choose-list">Back</button>
        <button class="btn" data-action="set-spreadsheet-id",  data-nav="choose-sheets">OK</button>
      </div>
    </div>

    <div id="choose-sheets" class="modal-content default-hidden">
      <h2 class="section main-text">Which sheets would you like to include?</h2>
      <div id="sheet-checkbox-group-wrapper" class="section">
      </div>
      <div data-error="set-sheets" class="section error-message default-hidden"></div>
      <div class="section">
        <button class="btn" data-nav="choose-spreadsheet">Back</button>
        <button class="btn" data-action="set-sheets">OK</button>
      </div>
    </div>
    
    <div id="flash-card" class="modal-content default-hidden">
      <div id="chinese-side" class="section default-hidden">
        <h2 id="hanzi" class="card-text"></h2>
        <h2 id="pinyin" class="card-text"></h2>
      </div>
      <div id="english-side" class="section default-hidden">
        <h2 id="english" class="card-text"></h2>
      </div>
      <div data-error="flip" class="section error-message default-hidden"></div>
      <div data-error="delay-zero-min" class="section error-message default-hidden"></div>
      <div data-error="delay-one-min" class="section error-message default-hidden"></div>
      <div data-error="delay-ten-min" class="section error-message default-hidden"></div>
      <div data-error="delay-one-hour" class="section error-message default-hidden"></div>
      <div class="section">
        <button class="btn" data-action="flip">Flip</button>
      </div>
      <div id="hide-for-section" class="section default-hidden">
        <button class="btn" data-action="delay-zero-min">X</button>
        <button class="btn" data-action="delay-one-min">1 Min</button>
        <button class="btn" data-action="delay-ten-min">10 Mins</button>
        <button class="btn" data-action="delay-one-hour">1 Hour</button>
      </div>
    </div>

    <div id="complete" class="modal-content default-hidden"> 
      <h2 class="section main-text">All Cards Complete!</h2>
      <div data-error="reset" class="section error-message default-hidden"></div>
      <div class="section">
        <button class="btn" data-action="reset">Reset</button>
      </div>
    </div>

    <div id="settings-panel" class="modal-content default-hidden">
      <h2 class="section main-text">Settings</h2>
      <div class="section">
        <label for="front-side-lang-select" class="label">Choose the language on front of card.</label>
        <select class="input" id="front-side-lang-select">
          <option class="option" value="Chinese">Chinese</option>
          <option class="option" value="English">English</option>
        </select>
      </div>
      <div data-error="update-settings" class="section error-message default-hidden"></div>
      <div class="section">
        <button class="btn" data-action="update-settings" data-nav="choose-list">Choose Data</button>
        <button class="btn" data-action="update-settings">Done</button>
      </div>
    </div>
  </div>

  <script src="bundle.js"></script>
</body>
</html>